<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>URANCORE</title>
<link rel="stylesheet" href="../style.css">
</head>
<body>
<a href="/index.html"><- Назад</a><p></p>
<div class="LINE"></div><h2>Содержание</h2>
<p></p>
<a href="#1">Многопоточность</a><p></p>
<a href="#2">Реализация в С</a><p></p>
<a href="#3">Пример</a><p></p>
<h1 id="1">1 Многопоточность</h1><p></p>
<ul>
<li>Поток - последовательность инструкций, выполняемых параллельно с другими потоками. При запуске программы создаётся как минимум один поток - главный. Если программа использует только его, она считается однопоточной.</li>
<li>Процесс - экземпляр выполняемой программы. Потоки существуют внутри одного процесса и могут взаимодействовать между собой, в отличие от процессов, которые изолированы друг от друга.</li>
</ul>
<p></p>
<p></p>
<h1 id="2">2 Реализация в C (pthread.h)</h1><p></p>
<p>В C потоки реализуются с помощью библиотеки pthread.h. Поток представлен типом pthread_t.</p>
<p>Создание потока осуществляется с помощью функции pthread_create:</p>
<p></p>
<pre><code>int pthread_create(
	pthread_t *thread,
	const pthread_attr_t *attr,
	void *(*routine)(void *),
	void *arg
);
</code></pre><p></p>
<p>Параметры:</p>
<ul>
<li>thread - указатель на переменную, в которую будет записан идентификатор потока.</li>
<li>attr - указатель на структуру с атрибутами потока (можно передать NULL для значений по умолчанию).</li>
<li>routine - функция, выполняемая в потоке. Принимает один аргумент типа <code>void *</code> и возвращает void *. Для передачи нескольких аргументов можно использовать структуру.</li>
<li>arg - аргумент, передаваемый в функцию потока.</li>
</ul>
<p></p>
<p>По умолчанию основной поток не ожидает завершения остальных. Чтобы дождаться окончания работы конкретного потока, используется функция pthread_join:</p>
<p></p>
<pre><code>int pthread_join(
	pthread_t thread,
	void **retval
);
</code></pre><p></p>
<p>Параметры:</p>
<ul>
<li>thread - идентификатор потока, завершения которого ожидается.</li>
<li>retval - указатель на переменную, в которую будет записан результат, возвращённый из потока (можно передать NULL, если результат не нужен).</li>
</ul>
<p></p>
<h1 id="3">3 Пример</h1><p></p>
<pre><code>#include &lt;pthread.h&gt;
#include &lt;stdio.h&gt;

void *some_work(void *arg)
{
	for (int i = 0; i &lt; 5; ++i) {
		puts(arg);
	}
	return NULL;
}

void *func2(void *arg)
{
	int m = 1;
	for (int i = 1; i &lt; 3; i++) {
		m *= (int)arg * i;
		printf("%d\n", m);
	}
	void *res = (void *)m;
	return res;
}

int main(void)
{
	pthread_t thread1, thread2;
	void *t2_result;

	pthread_create(&amp;thread1, NULL, some_work, "Hello World");
	pthread_create(&amp;thread2, NULL, func2, (void *)12);

	pthread_join(thread1, NULL);
	pthread_join(thread2, &amp;t2_result);

	printf("result: %d\n", (int)t2_result);
	printf("End...\n");
	return 0;
}
</code></pre><p></p>
<p>Вывод программы:</p>
<p></p>
<pre><code>Hello World
Hello World
Hello World
Hello World
Hello World
12
288
result: 288
End...
</code></pre><p></p>
<div class="LINE"></div><p></p>
<a href="/index.html"><- Назад</a></body>
</html>
